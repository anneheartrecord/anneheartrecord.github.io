<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="永远不要高估自己">
<meta property="og:type" content="website">
<meta property="og:title" content="安妮的心动录的园子">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="安妮的心动录的园子">
<meta property="og:description" content="永远不要高估自己">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="安妮的心动录">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>安妮的心动录的园子</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">安妮的心动录的园子</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="download fa-fw"></i>资源</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/31/Go%E7%BC%96%E8%AF%91%E7%9B%B8%E5%85%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="安妮的心动录">
      <meta itemprop="description" content="永远不要高估自己">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安妮的心动录的园子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/31/Go%E7%BC%96%E8%AF%91%E7%9B%B8%E5%85%B3/" class="post-title-link" itemprop="url">Go编译相关</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-10-31 22:52:56 / 修改时间：23:06:37" itemprop="dateCreated datePublished" datetime="2022-10-31T22:52:56+08:00">2022-10-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Go/" itemprop="url" rel="index"><span itemprop="name">Go</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Go编译相关"><a href="#Go编译相关" class="headerlink" title="Go编译相关"></a>Go编译相关</h1><h2 id="Go的一些环境变量"><a href="#Go的一些环境变量" class="headerlink" title="Go的一些环境变量"></a>Go的一些环境变量</h2><p>在我们安装Go语言的时候，都要设置一些环境变量，最重要的就是GOROOT和GOPATH，那么他们分别代表的是什么呢？</p>
<p>下图是所有的Go环境变量</p>
<p><img src="/2022/10/31/Go%E7%BC%96%E8%AF%91%E7%9B%B8%E5%85%B3/1.jpg"></p>
<p>随便挑几个</p>
<ul>
<li><p>GOROOT是GO的安装路径，有一些关于操作系统方面的支持和编译器、链接器等等</p>
</li>
<li><p>GOPATH是一个工作空间，目的是提供一个寻找.go源码的路径，可以设置多个目录，GO官方要求需要包含三个文件夹，src存放源文件，pkg存放编译后的库文件，后缀为.a，bin则存放可执行文件。</p>
</li>
<li><p>GOOS是Go当前所在的操作系统</p>
</li>
<li><p>GOARCH是Go所在的计算机架构</p>
</li>
<li><p>GO111MODULE表示是否开启Gomod</p>
</li>
<li><p>GOPROXY表示代理，direct表示是否直接走代理</p>
</li>
<li><p>CGO表示是否开启CGO</p>
</li>
</ul>
<p>在交叉编译的时候就要使用到GOOS和GOARCH，交叉编译指的是：编译的平台和代码最终运行的平台不一样，我们都知道，不同机器的机器码是不一样的，不是说一个二进制文件，在所有机器上都可以执行的。</p>
<p>比如这么一个场景：你的开发环境是Win10，但是服务器是Centos7，这时候你想要让代码在服务器上运行，可以有这么两种解决方案</p>
<ol>
<li>把整个工程文件传到服务器上，在服务器上进行编译和运行，但这显然不方便，因为你还要在服务器上安装Go</li>
<li>在开发环境进行编译，编译出的二进制文件能够在服务器上运行</li>
</ol>
<p>显然第二种解决方案更加简单</p>
<p>那么该怎么做呢？</p>
<ol>
<li>修改GOOS和GOARCH为对应的平台与计算机架构，在Go1.13之后修改环境变量要用到go env -w  </li>
<li>GOOS&#x3D;linux GOARCH&#x3D;amd64 go build &#x2F;&#x2F;分别指定对应的平台和机器的位数</li>
</ol>
<p>当然，在实际开发中一般环境都是和服务器相同的(操作系统和机器位数)，这样就不会有类似的问题。</p>
<h2 id="Go代码编译链接过程"><a href="#Go代码编译链接过程" class="headerlink" title="Go代码编译链接过程"></a>Go代码编译链接过程</h2><p><img src="/2022/10/31/Go%E7%BC%96%E8%AF%91%E7%9B%B8%E5%85%B3/2.png"></p>
<p>从上图可以看出来，一份Go代码需要先经过编译器的编译称为汇编程序，再通过汇编器成为二进制可执行程序，再经过链接器的链接，最后才成为了一份二进制可执行文件。</p>
<p>具体过程：go build其实就是编译和链接的过程，编译是指对源文件进行词法分析、语法分析、语义分析、优化，最后生成汇编代码文件，以.s作为文件的后缀。之后，汇编器会将汇编代码转变成机器可以执行的指令，每一条汇编语句都与一条机器指令对应。编译是一个很智能的过程，里面还包含了优化的部分，而汇编则是比较机械的部分，将汇编语句转换成机器指令。</p>
<p>编译过程</p>
<p><img src="/2022/10/31/Go%E7%BC%96%E8%AF%91%E7%9B%B8%E5%85%B3/3.png"></p>
<p>主要过程就是：扫描、语法分析、语义分析、源代码优化、代码生成、目标代码优化</p>
<p>词法分析（扫描）：将源代码字符序列转换为标记(token)序列的过程 进行这个步骤的程序叫做词法分析器，也叫作扫描器(scanner)，一般以函数的方式存在，.go文件被输入到scanner，它使用一种类似于有限状态机的算法，将源代码的字符系列分割成一系列的token。token分为这几种：关键字、标识符、字面量、特殊符号等等</p>
<p>Go语言scanner的具体逻辑就是通过next函数，获取下一个未被解析的字符，并且跳过之后的空格，回车，换行，tab这些字符，进入一个大的switch-case语句，匹配不同的情况。</p>
<p>语法分析：上一步生成的token序列，需要经过进一步的处理，生成一颗以表达式为结点的语法树（把符号组成一个句子）</p>
<p>语义分析：检查常量、类型、函数声明等等，可以把这一步看成静态检查，如果有很明显的语法错误，就会报错。</p>
<p>中间代码生成：编译过程可以分为前端和后端，前端生成和平台无关的中间代码，而后端会针对不同的平台，生成不同的机器码，前面的词法分析、语法分析、语义分析都属于编译器前端，后面的阶段属于编译器后端。</p>
<p>目标代码生成与优化：不同机器的机器字长、寄存器都不一样，意味着在不同机器上跑的机器码是不一样的，最后一步的目的就是要生成能在不同CPU架构上运行的代码。目标代码优化器会对一些指令进行优化，提升程序的效率。</p>
<p>链接：将编译器生成的一个个目标文件链接成可执行文件，最后得到的文件是分成各种段的。</p>
<p>其实关于编译链接这部分的内容还有很多需要学习的，这里只是简单的说明了一下，具体可以参考《程序员自我修养》这本书</p>
<h2 id="Go编译相关命令"><a href="#Go编译相关命令" class="headerlink" title="Go编译相关命令"></a>Go编译相关命令</h2><p>Go语言的源码分为三类：命令源码、库源码、测试源码</p>
<p>命令源码：Go程序的入口，包含func main() 函数，且第一行用package main声明属于main包</p>
<p>库源码：主要是各种函数、各种接口，例如工具类的函数</p>
<p>测试源码：以_test.go为后缀，用于测试功能、性能等</p>
<p>与编译相关的Go命令主要有三个</p>
<ul>
<li>go build</li>
<li>go install</li>
<li>go run</li>
</ul>
<p>go build的一些参数</p>
<ul>
<li>-a 强制重新编译所有涉及到的包</li>
<li>-n 打印命令执行过程 不真正执行</li>
<li>-p n 打印命令执行的并行数 n默认为cpu核数</li>
<li>-race 检测并报告程序中的数据竞争问题</li>
<li>-v 打印命令执行中涉及到的代码包名称</li>
<li>-x 打印命令过程中涉及到的命令 并执行</li>
<li>-work 打印编译过程中的临时文件夹，编译完成后会被删除</li>
</ul>
<p>go build：编译过程会忽略掉测试源码 执行过程是递归寻找main.go所依赖的包，以及依赖的依赖，直至最低层的包，如果有循环依赖，则直接退出</p>
<p>go install ：编译并安装指定的代码包，相比于Go build，它多了一个“安装编译后的结果文件到指定目录”的步骤</p>
<p>go run ：先编译，再链接，再执行</p>
<h2 id="Go程序启动过程"><a href="#Go程序启动过程" class="headerlink" title="Go程序启动过程"></a>Go程序启动过程</h2><p>1.检查运行平台的CPU 设置好程序运行需要相关标志</p>
<p>2.TLS的初始化</p>
<p>3.runtime包进行变量和调度器的设置</p>
<p>4.创建新的goroutine绑定用户的main方法</p>
<p>5.开始进行goroutine的调度</p>
<p><img src="/2022/10/31/Go%E7%BC%96%E8%AF%91%E7%9B%B8%E5%85%B3/4.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/31/Go-defer%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="安妮的心动录">
      <meta itemprop="description" content="永远不要高估自己">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安妮的心动录的园子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/31/Go-defer%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">Go defer详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-10-31 22:52:12 / 修改时间：22:56:57" itemprop="dateCreated datePublished" datetime="2022-10-31T22:52:12+08:00">2022-10-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Go/" itemprop="url" rel="index"><span itemprop="name">Go</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Go-defer详解"><a href="#Go-defer详解" class="headerlink" title="Go defer详解"></a>Go defer详解</h1><h3 id="什么是defer"><a href="#什么是defer" class="headerlink" title="什么是defer"></a>什么是defer</h3><p>在进行编程的时候，经常需要在代码中申请一些资源，比如数据库连接，文件句柄等等，这些资源需要在用完之后进行释放，否则会造成内存泄漏（内存一直被占用而不被释放，造成系统内存的浪费，导致程序运行速度减慢甚至系统崩溃等严重后果），而Go就提供了一个defer关键字，可以实现延迟调用。defer可以让函数或者语句在当前函数执行完毕后执行（包括程序正常退出和panic导致的异常结束）</p>
<p>以下代码有什么问题？</p>
<p><code>r.mu.Lock()</code></p>
<p><code>rand.Intn(param)</code></p>
<p><code>r.mu.Unlock()</code></p>
<p>看起来这段代码是没有什么问题的，但这是建立在程序正常运行的基础上，如果rand.Intn出现了异常而造成了panic，就会出现r一直占用着锁而不释放的问题，所以即使是简单的释放资源的代码，使用defer也是很有必要的。</p>
<h3 id="defer的执行顺序"><a href="#defer的执行顺序" class="headerlink" title="defer的执行顺序"></a>defer的执行顺序</h3><p>defer的语句并不会马上执行，而是会进入一个栈，所以执行的顺序也会和栈一样，即先进后出，也就是说最先被定义的defer语句最后执行，这个原因是后面定义的函数可能对前面的资源有依赖，所以要先执行；否则如果前面先执行了，对某些资源进行释放，后面的函数就会出错。</p>
<p>在defer函数定义时，对外部变量的引用有两种方式，函数参数和闭包引用，前者在defer定义时就把值（广义的值，如果传的是引用类型，那么和定义的时候可能不一样）传给defer，并被存起来，而后者则会在defer真正调用的时候根据上下文确定值。</p>
<p>如果是闭包的话，则会和定义的时候不一样，看下面这个栗子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func main() &#123;</span><br><span class="line">   var t [3]struct&#123;&#125;</span><br><span class="line">   for i := range t &#123;</span><br><span class="line">      defer func() &#123;</span><br><span class="line">         fmt.Println(i) //defer 后面接的是闭包 在for 循环结束后的i的值为2</span><br><span class="line">      &#125;()</span><br><span class="line">   &#125;</span><br><span class="line">   // 2</span><br><span class="line">   // 2</span><br><span class="line">   // 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>注意：在Go使用close()关闭某些资源的时候，最好提前判断调用主体是否为空，否则很可能会解引用一个空指针，从而造成panic的问题</p>
<h3 id="return与defer"><a href="#return与defer" class="headerlink" title="return与defer"></a>return与defer</h3><p>return并不是一条原子指令，return的执行顺序是这样的</p>
<p>1.返回值&#x3D;xxx</p>
<p>2.调用defer函数</p>
<p>3.ret指令</p>
<p>下面是两道defer经典题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">func f1() int &#123;  //返回值没有取名</span><br><span class="line">   x := 5</span><br><span class="line">   defer func() &#123;</span><br><span class="line">      x++</span><br><span class="line">   &#125;()</span><br><span class="line">   return x       //1.返回值赋值 2.defer 3.执行RET返回  //开辟了一份空间 return语句先将5赋值给x defer修改了x的值 但是RET命令执行的对象还是那个‘5’</span><br><span class="line">&#125;</span><br><span class="line">func f2() (x int) &#123;  //返回值有名字</span><br><span class="line">   defer func() &#123;</span><br><span class="line">      x++ //闭包</span><br><span class="line">   &#125;()</span><br><span class="line">   return 5  //修改的是x的值</span><br><span class="line">&#125;</span><br><span class="line">func f3() (y int) &#123;</span><br><span class="line">   x := 5</span><br><span class="line">   defer func() &#123;</span><br><span class="line">      x++</span><br><span class="line">   &#125;()</span><br><span class="line">   return x   //y = x = 5  defer修改的是 x 真正返回的y还是5</span><br><span class="line">&#125;</span><br><span class="line">func f4() (x int) &#123;</span><br><span class="line">   defer func(x int) &#123;</span><br><span class="line">      x++   //改的是函数值的副本  //如果这里是 defer func(x *int) &#123; x ++ &#125;(x) </span><br><span class="line">   &#125;(x)     //那么结果就会变成6</span><br><span class="line">   return 5  </span><br><span class="line">&#125;</span><br><span class="line">func main() &#123;</span><br><span class="line">   fmt.Println(f1())  //5</span><br><span class="line">   fmt.Println(f2())  //6</span><br><span class="line">   fmt.Println(f3())  //5</span><br><span class="line">   fmt.Println(f4())  //5</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">func main() &#123;</span><br><span class="line">   x := 1</span><br><span class="line">   y := 2</span><br><span class="line">   defer calc(&quot;AA&quot;, x, calc(&quot;A&quot;, x, y))</span><br><span class="line">   x = 10</span><br><span class="line">   defer calc(&quot;BB&quot;, x, calc(&quot;B&quot;, x, y))</span><br><span class="line">   y = 20</span><br><span class="line">    //1.调用calc中的calc(&quot;A&quot;,x,y)  输出:&quot;A&quot;,1,2,3 因为函数调用时会确定每个参数的值</span><br><span class="line">    //2.defer calc(&quot;AA&quot;,x,3)</span><br><span class="line">    //3.调用第二个calc中的calc(&quot;B&quot;,x,y)  此时x y是20 输出:&quot;B&quot;,10,2,12</span><br><span class="line">    //4.defer calc(&quot;BB&quot;,x,12)</span><br><span class="line">    //5.先进后出 调用第二个calc 输出:&quot;BB&quot;,10,12,22</span><br><span class="line">    //6.调用第二个calc 输出:&quot;AA&quot; 1,3,4</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="什么是闭包"><a href="#什么是闭包" class="headerlink" title="什么是闭包"></a>什么是闭包</h3><p>闭包&#x3D;函数+引用环境 不推荐在生产环境中使用，就算你自己对闭包的使用很熟练，但是代码写出来是给人看的，不能苛求你的同事、测试对这部分也很熟悉，而且闭包很容易出现错误。</p>
<p>Go中的所有匿名函数都是闭包程序</p>
<h3 id="defer配合recover使用"><a href="#defer配合recover使用" class="headerlink" title="defer配合recover使用"></a>defer配合recover使用</h3><p>执行初始化的时候出问题，最好直接panic掉，避免上线之后出现更大的问题，有些时候，需要从异常中恢复，比如服务器的严重问题产生了panic，这个时候需要在程序崩溃之前做一些扫尾工作，比如关闭客户端的连接。并且一个panic不应该影响整个服务器的运行，这时候就需要defer 和 recovery进行配合 </p>
<p>defer配合recovery使用:recovery必须在defer的函数中 才是标准格式 </p>
<p>比如这种</p>
<p><code>func main() &#123;</code><br>    <code>defer f()</code><br>    <code>panic(404)</code><br><code>&#125;</code></p>
<p><code>func f() &#123;</code><br>    <code>if err := recover(); err != nil &#123;</code><br>        <code>fmt.Println(&quot;recover&quot;)</code><br>        <code>return</code><br>    <code>&#125;</code><br><code>&#125;</code></p>
<p>或者采用匿名函数</p>
<p><code>func main() &#123;     defer func() &#123;         if err := recover(); err != nil &#123;             fmt.Println(&quot;recover&quot;)             return         &#125;     &#125;()     panic(404) &#125;</code></p>
<p>但是注意，一定要在<strong>函数</strong>里，像这样是不行的</p>
<p><code>func main() &#123;     defer recover()     panic(404) &#125;//还是会panic</code></p>
<h3 id="defer链是如何被执行的"><a href="#defer链是如何被执行的" class="headerlink" title="defer链是如何被执行的"></a>defer链是如何被执行的</h3><p>前面我们说到过，一个函数中的defer语句是按照栈的顺序执行的，每一条defer语句都会创建一个_defer结构体，这些结构体以链表的形式挂载在G下（Goroutine)。</p>
<p>defer首先会调用deferporc函数，new一个_defer结构体，挂到G上，当然，调用new之前会从当前G绑定的P中的defer pool中取，如果没有的话则会去全局的defer pool中取，是在没有就新建一个，这是Go runtime的常规操作，也就是设置多级缓存，提高运行效率。 </p>
<p>之后按照顺序，处理一个个_defer结构体，即完成了defer链的执行。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/22/RSA%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="安妮的心动录">
      <meta itemprop="description" content="永远不要高估自己">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安妮的心动录的园子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/22/RSA%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">RSA详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-10-22 11:07:45 / 修改时间：11:11:34" itemprop="dateCreated datePublished" datetime="2022-10-22T11:07:45+08:00">2022-10-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">密码学</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="RSA详解"><a href="#RSA详解" class="headerlink" title="RSA详解"></a>RSA详解</h1><h2 id="1-RSA思想"><a href="#1-RSA思想" class="headerlink" title="1.RSA思想"></a>1.RSA思想</h2><p>  RSA公开密钥密码体制是一种使用不同的加密密钥和解密密钥，由“已知加密密钥推导出解密密钥在计算上是不可行的”密码体制。</p>
<p>  在这种体制中，加密秘钥（公钥）PK是公开信息，而解密密钥（私钥）SK是需要保密的，加密算法E和解密算法D也都是公开的，这样的话虽然SK是由PK决定的，但是不能通过PK计算出SK。</p>
<p>​	基于这种思想，在1978年出现了著名的RSA算法。</p>
<ol>
<li>通常是先生成一对RSA密钥</li>
<li>其中的一个是私钥，用户保存，另一个是公钥，可对外公开，甚至可以在网络服务器中注册</li>
<li>为了提高保密强度，密钥至少为500位，一般推荐1024位</li>
<li>为了减少计算量，传送信息的时候通常采用传统加密与公开密钥加密结合的方式</li>
</ol>
<p>算法原理：根据数论的理论，找两个大素数比较简单，对他们的乘积进行因式分解却很困难，因此可以将乘积公开作为加密秘钥</p>
<h2 id="2-算法描述"><a href="#2-算法描述" class="headerlink" title="2.算法描述"></a>2.算法描述</h2><ol>
<li>任意选两个不同的大素数p和q计算乘积n&#x3D;pq，欧拉函数n&#x3D;p-1 * q-1 </li>
<li>任意选一个大整数e，满足 gcd (e,欧拉n)&#x3D;1，整数e用作加密钥</li>
<li>确定的解密要d 满足(de) mod 欧拉n &#x3D;1 很容易计算出d </li>
<li>公开n和e 保存d</li>
<li>将明文m(m&lt;n)加密成c 加密算法为 c&#x3D;m^e mod n </li>
<li>将密文c解密为明文m  解密算法为 m&#x3D;c^d mod n</li>
</ol>
<p>通俗易懂的解释：</p>
<p>1.第一步 随机选择两个不相同的质数 p 和 q  比如61和53，在实际应用中，这两个质数越大，就越难破解</p>
<p>2.第二步 计算p和q的乘积n  上面的栗子 n&#x3D;61*53&#x3D;3233</p>
<p>这个n就是密钥，写成二进制位110010100001，一共12位，那么这个密钥长度就是12位，在实际应用中,RSA密钥长度要到1024位，才具有足够的保密性</p>
<p>3.第三步，计算n的φ(n)</p>
<p>欧拉n&#x3D;p-1* q-1 上面的栗子为3120</p>
<p>4.第四步 随机选择一个整数e 条件为1&lt;e&lt;φ(n)，且e与欧拉n互质，实际应用中常用65537，我们这边随便选个17</p>
<p>5.计算e对于φ(n)的模反元素d </p>
<p>所谓模反元素就是指有一个整数d 可以让ed 被 φ(n) 除的余数为1</p>
<p>可以通过扩展欧几里得算法求解 </p>
<p>6.将n和e封装成公钥，n和d封装成私钥</p>
<p>可靠性：能不能在已知n和e的情况下，推出d，也就是能不能在已知公钥的情况下，推出私钥？</p>
<p>结论：不行，需要对大整数进行因式分解，这个过程很困难，目前被破解的最长RSA密钥为768位</p>
<p>7.加密过程：</p>
<p>通过公钥(n,e)对m进行加密，m必须为整数，且m必须小于n</p>
<p>加密过程</p>
<p>m ^ e ≡ c (mod n)</p>
<p>8.解密过程</p>
<p>c ^ d ≡ m (mod n)</p>
<h2 id="3-安全性描述"><a href="#3-安全性描述" class="headerlink" title="3.安全性描述"></a>3.安全性描述</h2><ul>
<li>保密强度随着密钥的长度增加而增强，但是密钥越长，加解密的时间也就夜场</li>
<li>RSA安全性依赖于大数分解</li>
<li>因为进行的都是大数计算，使得RSA的速度比DES慢上好几倍甚至好几十倍，因为AES这类算法通常厂商会在硬件方面进行优化，RSA一般只用于少量的数据加密，RSA的速度比对应同样安全级别的对称密码算法要慢1000倍左右</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/22/%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9A%84%E5%87%A0%E7%A7%8D%E5%8F%91%E5%B8%83%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="安妮的心动录">
      <meta itemprop="description" content="永远不要高估自己">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安妮的心动录的园子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/22/%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9A%84%E5%87%A0%E7%A7%8D%E5%8F%91%E5%B8%83%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">工业界的几种发布模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-10-22 11:07:35 / 修改时间：11:09:56" itemprop="dateCreated datePublished" datetime="2022-10-22T11:07:35+08:00">2022-10-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">计算机基础</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="工业界的几种发布模式"><a href="#工业界的几种发布模式" class="headerlink" title="工业界的几种发布模式"></a>工业界的几种发布模式</h1><h2 id="蓝绿发布"><a href="#蓝绿发布" class="headerlink" title="蓝绿发布"></a>蓝绿发布</h2><ul>
<li>蓝绿发布的本质上是通过系统冗余来解决上线风险的问题，通常生产环境中配置两套完全一样的环境，一组是active的生产环境配置（绿色），一组是inactivate的准备环境配置（蓝色），两套系统都是功能完善的，并且正在运行的系统，只是系统版本和对外服务情况不同</li>
<li>最初始的状态下，没有任何系统，也没有蓝绿之分，然后第一套系统开发完成直接上线，只有一个系统，后来业务更新，要用新版本替换线上的旧版本，这时候就有两个系统，正在对外提供服务的是老系统为绿色，新部署的系统为蓝色</li>
</ul>
<p>为什么要有蓝色系统？因为蓝色其实是为了对新版本进行全方位的测试</p>
<ul>
<li>如果测试没出问题，可以通过负载均衡器&#x2F;反向代理&#x2F;路由指向蓝色环境，之后只要检测这个环境是否有故障，如果运行良好， 就可以删除v1.0使用的资源，为下一次蓝绿部署空出可用资源</li>
<li>如果测试有问题，直接修改指向，快速回滚到绿色环境</li>
</ul>
<p>优点：部署过程中，应用始终在线，并且新版本没有修改老版本的任何内容，在部署期间，老版本的转改不收影响，风险很小，并且理论上可以在任何时间回滚到老版本</p>
<p>缺点：需要两套环境，冗余的基础设施。而且对于设计数据表结构变更等不可逆转的升级，不太适合</p>
<h2 id="金丝雀发布"><a href="#金丝雀发布" class="headerlink" title="金丝雀发布"></a>金丝雀发布</h2><p>金丝雀发布就是灰度发布，这两个东西是同一类策略，策略就是只有一套系统，并且逐渐替换这套系统。</p>
<p>指的是增量发布的一种类型，在原有版本可用的情况下，同时部署一个新版本应用作为“金丝雀”，测试新版本的性能和表现，以保证整体系统的稳定性。</p>
<p>发布过程</p>
<ul>
<li>从负载均衡列表里下掉</li>
<li>升级金丝雀应用</li>
<li>重新添加到负载均衡列表中</li>
<li>如果测试成功，升级其他的服务器，否则回滚</li>
</ul>
<p>通常会AB测试一起使用</p>
<h2 id="AB测试"><a href="#AB测试" class="headerlink" title="AB测试"></a>AB测试</h2><p>AB测试是效果测试，同一时间有多个版本的服务对外服务，这些服务都是经过足够测试，达到了上线标准的服务，有差异但是没有新旧之分，核心目的是用来测试应用功能表现的方法。比如页面的样式、颜色不一样，最后通过分析各个服务的实际效果，选择效果最好的版本。</p>
<h2 id="滚动发布"><a href="#滚动发布" class="headerlink" title="滚动发布"></a>滚动发布</h2><p>所谓滚动发布一般是取出一个或者多个服务器停止服务，执行更新，并重新投入使用，周而复始，直到集群中的所有实例都更新成新版本，比如每次选出集群中的20%进行升级。比蓝绿部署更节省资源。</p>
<p>缺点：</p>
<ul>
<li>没有一个确定OK的环境</li>
<li>需要回滚的话很麻烦</li>
</ul>
<h2 id="红黑部署"><a href="#红黑部署" class="headerlink" title="红黑部署"></a>红黑部署</h2><p>这是Netfix采用的部署手段，主要基础设施在AWS上，它利用了AWS的特性，在部署新的版本的时候，通过AutoScaling Group 用包含新版本的AMI创建新的服务器，服务始终在线，同时采用不可变部署的方式。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/22/%E5%AE%B9%E9%94%99%E3%80%81%E9%AB%98%E5%8F%AF%E7%94%A8%E5%92%8C%E7%81%BE%E5%A4%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="安妮的心动录">
      <meta itemprop="description" content="永远不要高估自己">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安妮的心动录的园子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/22/%E5%AE%B9%E9%94%99%E3%80%81%E9%AB%98%E5%8F%AF%E7%94%A8%E5%92%8C%E7%81%BE%E5%A4%87/" class="post-title-link" itemprop="url">容错、高可用和灾备</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-10-22 11:07:22 / 修改时间：11:13:19" itemprop="dateCreated datePublished" datetime="2022-10-22T11:07:22+08:00">2022-10-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">计算机基础</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>429</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="容错、高可用和灾备"><a href="#容错、高可用和灾备" class="headerlink" title="容错、高可用和灾备"></a>容错、高可用和灾备</h1><p>容错：指的是在发生故障时，系统仍然能够继续运行，比如飞机的设计就遵从了容错的思想，如果一个引擎坏了，剩下几个引擎，仍然能够飞。容错的目的是：发生故障时，系统的运行水平可能有所下降，但是依然可用，不会完全失效。</p>
<p>高可用：系统能比正常时间更久地保持一定的运行水平，骑车的备胎就是一个高可用的栗子，如果没有备胎，轮胎坏了，车就开不久，备胎延长了骑车行驶的可用时间。指的是一旦中断能够快速恢复，且中断必须是短暂的。</p>
<p>灾备：发生灾难时恢复业务的能力。如果飞行员是业务的话，飞机就是基础设施，飞行员的弹射装置就是灾备措施，一旦飞机即将坠毁，基础设施就要没了，灾备可以让业务幸存下来。目的：保留系统的核心部分，一个好的灾备方案，就是从失败的基础佘时仲获取企业最宝贵的数据，然后在新的基础设施上恢复它们。</p>
<p>总结可以通过以上的三个方面结合起来，设计一个可靠的系统</p>
<ul>
<li>容错：发生故障的时候，如何让系统继续运行</li>
<li>高可用：系统中断时，如何尽快恢复</li>
<li>灾备：系统毁灭时，如何抢救数据</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/18/CPU%E4%B8%8EGPU%E7%9A%84%E5%8C%BA%E5%88%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="安妮的心动录">
      <meta itemprop="description" content="永远不要高估自己">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安妮的心动录的园子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/18/CPU%E4%B8%8EGPU%E7%9A%84%E5%8C%BA%E5%88%AB/" class="post-title-link" itemprop="url">CPU与GPU的区别</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-10-18 20:33:36 / 修改时间：20:37:35" itemprop="dateCreated datePublished" datetime="2022-10-18T20:33:36+08:00">2022-10-18</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>912</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CPU和GPU的区别"><a href="#CPU和GPU的区别" class="headerlink" title="CPU和GPU的区别"></a>CPU和GPU的区别</h1><p>CPU：Central Processing Unit 中央处理器，是计算机的大脑，包括运算器、控制器、寄存器、高速缓存以及总线</p>
<p>GPU：Graphics Processing Unit 图形处理器，最初是用在个人电脑、工作站、游戏机和一些移动设备上运行绘图运算工作的微处理器。</p>
<p>CPU和GPU之所以大不相同，主要是由于设计目标的不同，分别针对两种不同的应用场景。</p>
<p>CPUI需要很强的通用性来处理各种不同的数据类型，同时又要逻辑判断引入大量的分支跳转和中断的处理，这些使得CPU的内部结构是很复杂的。</p>
<p><img src="/2022/10/18/CPU%E4%B8%8EGPU%E7%9A%84%E5%8C%BA%E5%88%AB/image-20221018203400386.png" alt="image-20221018203400386"></p>
<p>而GPU所面对的数据则是类型高度统一、相互无依赖的大规模数据和不需要被打断的纯净的计算环境，所以GPU的构成相对简单，有数量众多的计算单元和超长的流水线，特别适合处理量大且同一的数据。在设计上采用了众多的计算单元和超长的流水线，但只有简单的控制逻辑并且省去了cache</p>
<p>除了渲染图形的能力，在并行处理方面GPU是很强的，因此在密码破译，大数据处理，金融分析等领域应用广泛（所以为什么会有那么多矿卡知道了吧）。其实GPU并没有专门为图像服务的部件。</p>
<p>为什么GPU擅长处理图像数据呢？这是因为图像上的每一个像素带你都有被处理的需要，而且每个像素点处理的过程和方式都十分类似，很适合机械的GPU进行处理。但是GPU无法单独工作，必须由CPU进行控制调用，CPU可单独作用，处理复杂的逻辑运算和不同的数据类型。</p>
<p>打个比方，GPU的运算速度取决于雇佣了多少小学生，CPU的运算速度取决于请了多么厉害的教授，教授处理复杂任务的能力是碾压小学生的，但是对于没那么复杂的任务，还是顶不住人多。</p>
<p>为什么在人工智能领域GPU十分盛行呢？因为深度学习是模拟人脑神经系统简历的数学网络模型，这个模型的最大特点是需要大数据来训练。所以需要大量的并行的重复计算，在深度学习方面GPU有以下特点</p>
<ul>
<li>提供了多核并行计算的基础结构，且核心数很多（通常有成百上千个核心），可以支撑大量数据的并行计算。</li>
<li>用于更高的访存带宽和速度</li>
<li>具备更高的浮点运算能力</li>
</ul>
<p>独立显卡：把GPU焊死在了显卡的电路板上，上面有一个散热风扇</p>
<p>集成显卡：把GPU和CPU放在一起，共用缓存来工作，并共用风扇。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/13/JSON%E7%9A%84%E5%87%A0%E7%A7%8D%E6%A0%87%E5%87%86%E6%A0%BC%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="安妮的心动录">
      <meta itemprop="description" content="永远不要高估自己">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安妮的心动录的园子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/13/JSON%E7%9A%84%E5%87%A0%E7%A7%8D%E6%A0%87%E5%87%86%E6%A0%BC%E5%BC%8F/" class="post-title-link" itemprop="url">JSON的几种标准格式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-10-13 21:23:20 / 修改时间：21:24:03" itemprop="dateCreated datePublished" datetime="2022-10-13T21:23:20+08:00">2022-10-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>754</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="JSON的几种标准格式"><a href="#JSON的几种标准格式" class="headerlink" title="JSON的几种标准格式"></a>JSON的几种标准格式</h1><p>  今天在使用mongoimport导入json格式的时候发现出问题了，需要我去了解一下json的标准格式，在这之前我一直以为json是用{}括起来的键值对，且最后一个键值对不能有逗号。（弱者的自嘲）</p>
<h2 id="什么是JSON"><a href="#什么是JSON" class="headerlink" title="什么是JSON"></a>什么是JSON</h2><ul>
<li>json是JavaScript Object Notation（JavaScript对象表示法）</li>
<li>json是轻量级的文本数据交换格式</li>
<li>json独立于语言</li>
<li>json具有自我描述性，更衣理解</li>
<li>json使用js语法来描述数据对象，但是json仍然独立于语言和平台，json解析器和json库支持许多不同的变成语言</li>
</ul>
<p>json是一种轻量级的数据交换格式，易于人阅读和编写，同时也易于机器解析和生成，之所以json这么流行，是因为json的结构和多级结构体刚好能对应上，而前后端交互的时候后端通常会返回给前端一个多级的结构体，于是json慢慢开始流行了，且json是跨语言和跨平台的，自身也足够轻量级。</p>
<p>json的标准格式</p>
<h5 id="json数值"><a href="#json数值" class="headerlink" title="json数值"></a>json数值</h5><p><code>//每个key对应的是一个value</code> </p>
<p><code>&#123;</code></p>
<p>​	<code>“k1&quot;: 1,</code></p>
<p>​	<code>&quot;k2&quot;: 2</code> &#x2F;&#x2F;注意结尾的这个不能有逗号</p>
<p><code>&#125;</code></p>
<h5 id="json字符串"><a href="#json字符串" class="headerlink" title="json字符串"></a>json字符串</h5><p><code>&#123;</code></p>
<p>​	<code>&quot;k1&quot;: &quot;1&quot;,</code></p>
<p>​	<code>&quot;k2&quot;: &quot;2&quot;</code></p>
<p><code>&#125;</code></p>
<h5 id="json数组"><a href="#json数组" class="headerlink" title="json数组"></a>json数组</h5><p>{</p>
<p>​	“k1”:  [1,2],</p>
<p>​	“k2”: [3,4]</p>
<p>}</p>
<h5 id="json对象"><a href="#json对象" class="headerlink" title="json对象"></a>json对象</h5><p>{</p>
<p>​	“k1”: {“1”: “haihai”},</p>
<p>​	“k2”: {“2”:”haihahai”}</p>
<p>}</p>
<h5 id="json对象数组"><a href="#json对象数组" class="headerlink" title="json对象数组"></a>json对象数组</h5><p>{</p>
<p>​	“k1”: [</p>
<p>​		{“k11”: “hellohello”},</p>
<p>​		{“k12”: “badbad”}</p>
<p>]</p>
<p>}</p>
<h5 id="json数组对象"><a href="#json数组对象" class="headerlink" title="json数组对象"></a>json数组对象</h5><p>{</p>
<p>​	“k2”: {</p>
<p>​	         “hello”: [1,2,3]</p>
<p>}</p>
<p>}</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/12/netrpc%E5%88%9D%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="安妮的心动录">
      <meta itemprop="description" content="永远不要高估自己">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安妮的心动录的园子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/12/netrpc%E5%88%9D%E8%AF%86/" class="post-title-link" itemprop="url">netrpc初识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-10-12 21:15:49 / 修改时间：21:17:01" itemprop="dateCreated datePublished" datetime="2022-10-12T21:15:49+08:00">2022-10-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Go/" itemprop="url" rel="index"><span itemprop="name">Go</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="net-x2F-rpc初识"><a href="#net-x2F-rpc初识" class="headerlink" title="net&#x2F;rpc初识"></a>net&#x2F;rpc初识</h1><p>RPC：远程调用过程协议，相关理论可以说是分布式和微服务的基础了，有需要的可以自行深入学习，简单来说RPC就是为了本机可以调用远程机器的子服务而产生的这么一种通信协议，基本上在后端开发中，RPC接口和HTTP接口的出现次数是最多的。</p>
<p>RPC通常和protobuf联系在一起，这么说其实不太准确，其实是grpc和protobuf联系在一起，因为protobuf序列化和反序列化的速度比json快，而且protobuf更加轻量级，更适合进行轻量的rpc通信（restful风格接口）</p>
<p>不管是轻量的GRPC框架，还是基于GRPC框架的微服务框架Go-Micro、Go-Kit等，它们在RPC这一块的实现肯定都是基于Go语言内建库：net&#x2F;rpc上的，很多人上来就直接去撸框架，我其实并不认同这种学习方法，从语言的底层开始学起显然是一种更优的方法。</p>
<p>来看看Go内置的rpc包</p>
<p>服务1：求圆形面积</p>
<p><code>server</code></p>
<p><code>//结构体 作为服务的接收者</code> </p>
<p><code>type  MathUtil struct&#123;</code></p>
<p><code>&#125;</code></p>
<p><code>//向外暴露的服务 对应着Go的方法 方法：有接收者的函数</code></p>
<p><code>//net/rpc规定 服务的参数只能有两个 第二个参数必须为指针 返回类型必须为error</code></p>
<p><code>func (mu *MathUtil) CalculateCircleArea(req float32,resp *float32) error &#123;</code></p>
<p> <code>*resp=math.Pi * req * req</code></p>
<p>​    <code>return nil</code> </p>
<p><code>&#125;</code></p>
<p><code>func main() &#123;</code></p>
<p>​	<code>//初始化指针类型数据</code></p>
<p>​	<code>mathUtil:=new(MathUtil)</code></p>
<p>​	<code>//调用 rpc注册服务</code></p>
<pre><code> `err:=rpc.Register(mathutil)`
</code></pre>
<p>​	 <code>if err!=nil &#123;</code></p>
<p>​	 <code>panic(err.Error())</code></p>
<p>​	<code>return</code> </p>
<p>​	<code>&#125;</code></p>
<p>​	 <code>//将服务注册到http协议上，调用者可以通过http的方式进行调用</code></p>
<p>​	<code>rpc.HandleHTTP()</code></p>
<p>   <code>//进行特定端口的监听</code></p>
<p>​	<code>listen,err:=net.Listen(&quot;tcp&quot;,&quot;:8087&quot;)</code></p>
<p>​	<code>if err!=nil &#123;</code></p>
<p>​	<code>panic(err.Error())</code>   </p>
<p>​	<code>&#125;</code></p>
<p>​	<code>http.Serve(listen,nil)</code></p>
<p><code>&#125;</code></p>
<p><code>client</code></p>
<p><code>func main() &#123;</code></p>
<p>  <code>//拨通HTTP</code></p>
<p>  <code>client, err := rpc.DialHTTP(&quot;tcp&quot;, &quot;localhost:8087&quot;)</code></p>
<p>  <code>if err != nil &#123;</code></p>
<p>​    <code>panic(err.Error())</code></p>
<p>  <code>&#125;</code></p>
<p>  <code>var req float32</code></p>
<p>  <code>req = 2</code></p>
<p>  <code>var resp *float32</code></p>
<p>  <code>//同步调用 Call的参数分别为服务名 注意这里的字符串是定死的 必须为 结构体.服务 和参数</code></p>
<p>  <code>err = client.Call(&quot;MathUtil.CalculateCircleArea&quot;, req, &amp;resp)</code></p>
<p>  <code>if err != nil &#123;</code></p>
<p>​    <code>panic(err.Error())</code></p>
<p>  <code>&#125;</code></p>
<p>  <code>fmt.Println(resp)</code></p>
<p>  <code>//异步调用</code></p>
<p>  <code>//syncCall := client.Go(&quot;MathUtil.CalculateCircleArea&quot;, req, &amp;resp, nil)</code></p>
<p>  <code>//replayDone := &lt;-syncCall.Done</code></p>
<p>  <code>//fmt.Println(replayDone)</code></p>
<p>  <code>//fmt.Println(*resp)</code></p>
<p><code>&#125;</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/11/ssh%E7%99%BB%E5%BD%95%E5%8F%8A%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="安妮的心动录">
      <meta itemprop="description" content="永远不要高估自己">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安妮的心动录的园子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/11/ssh%E7%99%BB%E5%BD%95%E5%8F%8A%E5%8E%9F%E7%90%86/" class="post-title-link" itemprop="url">ssh登录及原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-10-11 19:14:16" itemprop="dateCreated datePublished" datetime="2022-10-11T19:14:16+08:00">2022-10-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-12 21:22:33" itemprop="dateModified" datetime="2022-10-12T21:22:33+08:00">2022-10-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ssh登录及原理"><a href="#ssh登录及原理" class="headerlink" title="ssh登录及原理"></a>ssh登录及原理</h1><p>​	首先我们都知道ssh是一个远程授权的协议，通过ssh可以进行一些远程登录等操作，而scp就是在连接上远端服务器的ssh后有启动了一个scp进程，通过操作系统的stdin和stdout进行数据通信。</p>
<p>​	而火热的xshell和xftp其实就是对这两个命令的封装，xshell用来远程登录，xftp用来远程传输文件。</p>
<p>​	在ssh之前，其实就有一些能够实现远程登录的方式了，比如telnet（终端仿真协议），rcp(scp就是对rcp的升级），ftp等，但它们都是不安全的，并且会用明文传输密码，即使在私网上也有篡改和窃取的风险。</p>
<p>​	传统的远程服务如ftp很容易受到中间人攻击，所谓中间人就是存在另一台机器冒充真正的服务器接收用户传给服务器的数据，然后再冒充用户将</p>
<p>​	 ssh:secure shell 是由IETF制定的建立在应用层基础上的安全网络协议，专为远程登录会话和其他网络服务提供安全性的协议，通过SSH可以将所有传输的数据进行加密（RSA），同时能防止DNS欺骗和IP欺骗，并且数据经过压缩，可以加快传输的速度。</p>
<p>​	 </p>
<h5 id="ssh组成"><a href="#ssh组成" class="headerlink" title="ssh组成"></a>ssh组成</h5><ol>
<li>传输层协议  【SSH-TRANS】： 这部分提供了服务器认证，保密性及完整性，此外它还能够提供压缩功能，SSH-TRANS通常运行在TCP&#x2F;IP智商，也可能用于其他可靠的数据流上，TRANS提供了强力的加密技术、密码主机认证及完整性保护</li>
<li>用户认证协议：用于向服务器提供客户端用户鉴别功能，运行在运输层协议上，从低层协议接受会话标识符</li>
<li>连接协议：将多个加密隧道分成逻辑通道，运行在用户认证智商，提供交互式登录话路、远程命令执行。转发TCP IP连接等</li>
</ol>
<h5 id="ssh协议的具体实现："><a href="#ssh协议的具体实现：" class="headerlink" title="ssh协议的具体实现："></a>ssh协议的具体实现：</h5><ul>
<li>服务器建立公钥，每次启动sshd服务时，sshd会主动去找&#x2F;etc&#x2F;ssh&#x2F;ssh_host*文件，如果系统刚创建还没有这些文件，那么sshd会主动计算出这些公钥，同时也会计算出自己需要的私钥</li>
<li>客户端主动联机请求，如果客户端想要联机到ssh服务器，需要一个客户端程序，比如已经可以使用ssh的shell或者xshell这种使用了ssh的应用程序</li>
<li>服务器传输公钥给客户端，在拿到客户端请求之后，服务器把公钥给客户端</li>
<li>客户端记录并比对服务器公钥的数据，如果是第一次连接，则会把服务器公钥记录下来，如果不是第一次连接，则会去对比之间的记录，查看是否有差异。如果没有问题，客户端会接受这个公钥，然后开始计算客户端自己的公钥和私钥</li>
<li>客户端计算出自己的公钥和私钥会后回传给服务器，此时服务器就具有了服务器的私钥和客户端的公钥，客户端就有了服务器的公钥和客户端的私钥，开始非对称加密</li>
</ul>
<h5 id="ssh两种级别的验证方法"><a href="#ssh两种级别的验证方法" class="headerlink" title="ssh两种级别的验证方法"></a>ssh两种级别的验证方法</h5><ul>
<li>第一级（基于口令）：只要知道账号和口令，就能够登录到远程主机。所有的传输数据都会被加密，但不能保证连接的服务器是真实想要连接的服务器</li>
<li>第二级（基于密钥）：客户端需要为自身创建一对密钥，并把公钥放在需要访问的服务器上，如果要连接到ssh服务器，客户端会向服务器发出请求，需要用密钥进行安全验证。服务器收到之后，在目录下寻找保存的客户端公钥，再与现在客户端发过来的公钥进行对比。如果两个密钥一致，服务器就会用这个密钥加密“chanllenge”并发送回客户端，客户端收到之后用自己的私钥解密，然后再发送给服务器完成登录。（显然安全性比第一级高）</li>
</ul>
<h5 id="ssh和scp命令格式"><a href="#ssh和scp命令格式" class="headerlink" title="ssh和scp命令格式"></a>ssh和scp命令格式</h5><p>ssh 登录远程服务器</p>
<p>ssh username@ip</p>
<p>然后输入密码</p>
<p>scp从远程复制文件</p>
<p>&#x2F;&#x2F;传输一个文件</p>
<p>scp username@ip:remotefile file</p>
<p>&#x2F;&#x2F;传输一个目录</p>
<p>scp -r username@ip:remotefile file </p>
<p>如果需要用scp将本地文件复制到远程 只要将命令格式反过来就行</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/09/%E7%A7%81%E7%BD%91%E5%8F%8ANAT%E5%8D%8F%E8%AE%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="安妮的心动录">
      <meta itemprop="description" content="永远不要高估自己">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安妮的心动录的园子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/09/%E7%A7%81%E7%BD%91%E5%8F%8ANAT%E5%8D%8F%E8%AE%AE/" class="post-title-link" itemprop="url">私网及NAT协议</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-10-09 23:00:51" itemprop="dateCreated datePublished" datetime="2022-10-09T23:00:51+08:00">2022-10-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-10 09:17:32" itemprop="dateModified" datetime="2022-10-10T09:17:32+08:00">2022-10-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="私网及NAT协议"><a href="#私网及NAT协议" class="headerlink" title="私网及NAT协议"></a>私网及NAT协议</h1><p>在构建局域网时，通常局域网内部要使用私有IP地址，而管理员可以根据需求，选择一类、二类、三类的私有地址，这种私有地址我们一般称作私网地址，和公网相对，是没有真正连接到互联网上的。A B C三类网络都有一小块地址供全世界各地建设局域网使用，也就是每个企业都可以用私网，不同局域网的私网地址对应的主机是不一样的，这样就能够有效解决IPV4地址不足的问题。</p>
<p>私网地址分别为：</p>
<ul>
<li>A类 10.0.0.0~10.255.255.255</li>
<li>B类 172.16.0.0~172.31.255.255</li>
<li>C类 192.168.0.0~192.168.255.255</li>
</ul>
<p>不难看出来A类私网网址是B类数量的16倍，而B类又是C类数量的16倍，C类私网网址的数量为2^16，已经足够大部分的公司或企业进行IP地址的分配了，如果是特大型系统，也可以考虑使用A类或者B类，不过现实中这种情况比较少，所以我们看到的私网IP地址通常都是192.168开头的。</p>
<p>同时我们还要将私网与公网的关系和内网和外网的关系区分开来，</p>
<p>私网和公网是通过IP地址进行区分的，从特征上看私网IP并没有连接到互联网上，只是通过NAT协议在路由器层面连接到互联网，也就是一个局域网中的所有私网IP，对外看来是一致的，对方并不知道你是私网，也不知道你有多少台主机。而公网就是真正接入到互联网中的，我们可以通过网络对公网资源进行访问。</p>
<p>而内网和外网对应的是防火墙这个概念，在防火墙内的网络我们称之为内网，防火墙外的网络则为外网。我们常说的梯子，翻墙等就是通过这些工具暴露出来的接口（通常是socks5）的代理接口，翻越了国家防火墙（GFW）的限制，与国家防火墙外的代理服务器进行通讯。</p>
<p>那么私网中的计算机是如何访问到局域网之外的网络的呢？这就需要利用到NAT协议（网络转换协议）</p>
<p>NAT；NetWork Address Translation 在IP数据包通过路由器或者防火墙的时候重写来源IP地址或者目的IP地址的技术</p>
<p>典型情况</p>
<p>一个私有网络比如192.168.xx.xx和连接在这个网络上的一个路由器，路由器占用这个网络地址空间的一个专有地址，同时通过一个ISP提供的IP地址连接到因特网上，当信息从本地向互联网传递的时候，源地址从私有地址转换成公钥地址</p>
<p>缺点：一个具有NAT功能的路由器下的主机并没有创建真正的IP地址，因此不能参与某些因特网协议</p>
<p>优点：NAT能够减少IP地址不足的情况，使用方便。成本较低，并且可以阻止网络上的部分恶意活动</p>
<p>那么路由器是怎么知道哪个主机发送给外界消息的呢？当路由器接收到响应的时候，它又是怎么知道该转发给哪台主机的呢？</p>
<p>在一个私网IP的主机发送给NAT路由器消息的时候，路由器记录了它的内网地址和端口，并且分配给他一个全局地址和全局端口，这个地址关系记录在NAT路由表中，之后按照目的地址发送给服务器，一段时间后服务器响应，那么路由器根据目的地址和端口按照路由表转换成对应的主机地址，再发送给主机。简单来说就是有两次映射，针对出境包源地址进行替换，在NAT路由表中记录映射关系，针对入境包进行地址替换，找到对应的主机。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="安妮的心动录"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">安妮的心动录</p>
  <div class="site-description" itemprop="description">永远不要高估自己</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/anneheartrecord" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;anneheartrecord" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:chengxisheng777@gmail.com" title="E-Mail → mailto:chengxisheng777@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/2523286318" title="QQ → 2523286318"><i class="gratipay fa-fw"></i>QQ</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">安妮的心动录</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">22k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">20 分钟</span>
</div>



    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


</body>
</html>
